services:
  openclaw:
    # CORRECTION : On construit l'image depuis le code source (Build)
    build:
      context: .
      args:
        - OPENCLAW_BETA=${OPENCLAW_BETA:-false}
    
    container_name: openclaw
    restart: unless-stopped
    
    # On expose le port
    ports:
      - "18789:18789"
      
    environment:
      # --- CONFIG SYSTEME ---
      PORT: 18789
      # Désactive le bac à sable lourd (évite les bugs sur VPS)
      SANDBOX_CONTAINER: 'false'
      OPENCLAW_AUTO_BOOTSTRAP: 'true'
      OPENCLAW_STATE_DIR: /data/.openclaw
      
      # --- CERVEAU (GROQ) ---
      LLM_PROVIDER: 'openai'
      OPENAI_API_BASE: 'https://api.groq.com/openai/v1'
      LLM_MODEL: 'llama-3.1-8b-instant'
      OPENAI_API_KEY: '${OPENAI_API_KEY}'

    volumes:
      # Stockage persistant
      - openclaw-data:/data
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18789/"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  openclaw-data:
