services:
  openclaw:
    # On utilise la version stable officielle (téléchargement rapide)
    image: openclaw/openclaw:latest
    container_name: openclaw
    restart: unless-stopped
    
    # On expose le port pour que Coolify puisse le router vers ton domaine
    ports:
      - "18789:18789"
      
    environment:
      # --- CONFIGURATION SYSTEME ---
      PORT: 18789
      # CRUCIAL : On désactive le mode "Docker-dans-Docker" qui faisait planter ton instance précédente
      SANDBOX_CONTAINER: 'false'
      # On active le démarrage automatique de l'agent
      OPENCLAW_AUTO_BOOTSTRAP: 'true'
      # On définit le dossier de stockage propre
      OPENCLAW_STATE_DIR: /data/.openclaw
      
      # --- CERVEAU (GROQ FORCÉ) ---
      # On dit à OpenClaw d'utiliser le protocole standard
      LLM_PROVIDER: 'openai'
      # On pointe vers les serveurs ultra-rapides de Groq
      OPENAI_API_BASE: 'https://api.groq.com/openai/v1'
      # On choisit le modèle instantané pour commencer (tu pourras changer après)
      LLM_MODEL: 'llama-3.1-8b-instant'
      # Ta clé sera injectée par Coolify (plus sécurisé)
      OPENAI_API_KEY: '${OPENAI_API_KEY}'

    volumes:
      # Un seul volume propre pour tout stocker
      - openclaw-data:/data
    
    # Vérification de santé pour que Coolify sache quand c'est prêt
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18789/"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  openclaw-data:
